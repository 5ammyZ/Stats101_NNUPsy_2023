---
format: 
  revealjs:
    slide-number: true
    logo: images/image-393370223.png
    scrollable: true 
    theme: theme.scss
editor: visual
fontsize: 24pt
---

</br></br>

<h1 style="text-align: center">

12 - 假设检验(3)

</h1>

<h2 style="text-align: center">

(Hypothesis testing 3: Two types of errors & power analysis)

</h2>

</br></br>

<h3 style="text-align: center">

Hu Chuan-Peng

</h3>

<h3 style="text-align: center">

2023-05-17

</h3>

</br></br>

## Review

</br></br>

-   *p*值及其计算;</br></br>

-   *p*值的误用;</br></br>

-   误用*p*值的危害

## 假设检验步骤

</br></br>

-   提出假设;</br></br>

-   根据虚无假设H~0~所提供的前提条件，选择合适的统计模型;</br></br>

-   规定显著性水平$\alpha$;</br></br>

-   计算检验统计量的值;</br></br>

-   做出决策

# NHST框架下的两类错误

## 

</br></br>

南京某创造力培训班声称他们培训非常有效，在他们培训结束后36个6岁幼儿平均创造力潜质为105。假定正常的6岁幼儿的创造力潜质分数为100，标准差为15， 家长们想要了解该培训班是否真的有效，该如何决策？

## 

![](images/image-1948617480.png){fig-align="center"}

## 

</br></br>

H~0~成立下，出现培训后的6岁幼儿这样"高"创造力潜质的概率*p*$< \alpha$，不太可能在一次抽样中出现，所以我们拒绝H~0~。

## 

</br></br>

-   研究假设/对立假设/备择假设(Alternative Hypothesis)

    -   H~1~:与零假设相对立

    -   类似"总体参数之间有显著差异"或"总体分布不符合正态分布"

    -   在NHST框架下，零假设(H~0~)和备择假设(H~1~)是相互对立的，只有一个假设是正确的。

## 

-   如果零假设是正确的，那么经过培训班培训后的6岁幼儿平均创造力潜质与正常幼儿没有差异

-   即经过培训班培训后的6岁幼儿平均创造力潜质与正常幼儿属于同一个分布

![](images/image-409156073.png){fig-align="center"}

## 

-   如果备择假设是正确的，那么经过培训班培训后的6岁幼儿平均创造力潜质与正常幼儿存在差异

-   即经过培训班培训后的6岁幼儿平均创造力潜质与正常幼儿不属于同一个分布

![](images/image-1440186196.png){fig-align="center"}

## 

</br></br></br>

<center>我们做出决策时，一定能保证该决策是正确的吗？</center>

## 两类错误

|            | H~0~为真               | H~1~为真               |
|------------|------------------------|------------------------|
| 结果显著   | False positive(假阳性) | True positive          |
| 结果不显著 | True negative          | False negative(假阴性) |

</br>

![](images/%E5%B9%BB%E7%81%AF%E7%89%8716.PNG){fig-align="center"}

## 

假设疾控中心在某地发现一例新冠肺炎感染者，现对该感染者的密接人群进行核酸检测。

## 

-   密切人群中的感染情况：

    -   红色实体小人为疾控中心已知的感染者</br>
    -   红色边框小人为疾控中心未知的感染者</br>
    -   黑色边框小人为疾控中心未知的非感染者</br>

![](images/image-421926042.png){fig-align="center"}

## 

-   假设我们开启上帝视角，知道该密接人群的真实情况

    -   红色边框小人为真实感染者</br>
    -   黑色边框小人为真实非感染者</br>

![](images/image-1121244084.png){fig-align="center"}

## 

-   在疾控中心视角，他们对该密接人群的状况是未知的，因此要进行核酸检测
    -   蓝色边框小人表示在进行核酸检测前，疾控中心假定该人群没有人被感染

![](images/image-887213021.png){fig-align="center"}

## 

-   在疾控中心视角，他们要根据核酸检测的结果采取进一步措施
    -   在进行核酸检测后，红色虚线边框小人结果为阳性，蓝色边框小人结果为阴性

![](images/image-625266086.png){fig-align="center"}

## 

-   在上帝视角，我们知道疾控中心的检测结果出现了差错
    -   红色方框为假阴性错误，蓝色方框为假阳性错误

![](images/image-435269648.png){fig-align="center"}

## 真实的两类错误发生概率是多大？

</br></br>

|            | H~0~为真               | H~1~为真               |
|------------|------------------------|------------------------|
| 结果显著   | False positive(假阳性) | True positive          |
| 结果不显著 | True negative          | False negative(假阴性) |

</br></br>

H~0~为真的情况下，犯错误的概率为$\alpha$,又称**第一类错误**或**弃真错误**</br>

H~1~为真的情况下，犯错误的概率为$\beta$,又称**第二类错误**或**取伪错误**

## 

</br></br>

|            | H~0~为真                         | H~1~为真                        |
|-------------------|---------------------------|---------------------------|
| 结果显著   | False positive(假阳性)($\alpha$) | True positive($1-\beta$)        |
| 结果不显著 | True negative($1-\alpha$)        | False negative(假阴性)($\beta$) |

## 两类错误

</br></br>

-   H~0~为真
    -   拒绝H~0~:$\alpha$ = P(拒绝H~0~\| H~0~为真)
    -   不能拒绝H~0~:1-$\alpha$ = P(不能拒绝H~0~\| H~0~为真)</br>

</br></br>

-   H~1~为真
    -   不能拒绝H~0~:$\beta$ = P(不能拒绝H~0~\| H~1~为真)
    -   拒绝H~0~:1-$\beta$ = P(拒绝H~0~\| H~1~为真)

## 检测中的假阳性与假阴性到底有多高？

![](images/image-754605856.png){fig-align="center"}

## 

</br></br>

假设疾控中心发现某地有一例新冠肺炎感染者，某小区已封闭管理一个月，即将解封，现在疾控中心需要判断该小区是否存在疫情，他们做出正确决策或犯错误的概率是多少</br>

H~0~:该感染者居住的小区不存在疫情

## 两类错误出现的真实概率

</br></br>

$$\alpha=0.05,\beta=0.2$$

|              | H~0~为真(100%)                   | H~1~为真(0%)                     |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(？%) | 正确(？%)                        |
| 不能拒绝H~0~ | 正确(？%)                        | **第二类错误**/**取伪错误**(？%) |

## 

</br></br>

|              | H~0~为真(100%)                  | H~1~为真(0%)                    |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(5%) | 正确(0%)                        |
| 不能拒绝H~0~ | 正确(95%)                       | **第二类错误**/**取伪错误**(0%) |

## 

</br></br>

假设疾控中心发现某地有一例新冠肺炎感染者，现在疾控中心需要判断该感染者的同事居住的小区是否存在疫情</br>

-   H~0~:该感染者的同事居住的小区不存在疫情</br>

-   H~1~:该感染者的同事居住的小区存在疫情</br>

如果该感染者的同事感染新冠的概率为50%，在此情况下，疾控中心做出正确决策或犯错误的概率是多少？

## 

</br></br> $$\alpha=0.05,\beta=0.2$$

|              | H~0~为真(50%)                    | H~1~为真(50%)                    |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(？%) | 正确(？%)                        |
| 不能拒绝H~0~ | 正确(？%)                        | **第二类错误**/**取伪错误**(？%) |

## 

</br></br>

$$\alpha=0.05,\beta=0.2$$

|              | H~0~为真(50%)                     | H~1~为真(50%)                    |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(2.5%) | 正确(40%)                        |
| 不能拒绝H~0~ | 正确(47.5%)                       | **第二类错误**/**取伪错误**(10%) |

## 小练习1

</br></br>

假设疾控中心发现某地有一例新冠肺炎感染者，现在疾控中心需要判断该感染者的同事居住的小区是否存在疫情</br>

-   H~0~:该感染者的同事居住的小区不存在疫情</br>

-   H~1~:该感染者的同事居住的小区存在疫情</br>

如果该感染者的同事感染新冠的概率为90%

## 

</br></br> $$\alpha=0.05,\beta=0.2$$

|              | H~0~为真(10%)                    | H~1~为真(90%)                    |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(？%) | 正确(？%)                        |
| 不能拒绝H~0~ | 正确(？%)                        | **第二类错误**/**取伪错误**(？%) |

## 

</br></br>

$$\alpha=0.05,\beta=0.2$$

|              | H~0~为真(10%)                     | H~1~为真(90%)                    |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(0.5%) | 正确(72%)                        |
| 不能拒绝H~0~ | 正确(9.5%)                        | **第二类错误**/**取伪错误**(18%) |

## 小练习2

</br></br>

假设疾控中心发现某地有一例新冠肺炎感染者，现在疾控中心需要判断该感染者的同事居住的小区是否存在疫情</br>

-   H~0~:该感染者的同事居住的小区不存在疫情</br>

-   H~1~:该感染者的同事居住的小区存在疫情</br>

如果该感染者的同事感染新冠的概率为95%

## 

</br></br>

$$\alpha=0.05,\beta=0.2$$

|              | H~0~为真(5%)                     | H~1~为真(95%)                    |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(？%) | 正确(？%)                        |
| 不能拒绝H~0~ | 正确(？%)                        | **第二类错误**/**取伪错误**(？%) |

## 

</br></br>

$$\alpha=0.05,\beta=0.2$$

|              | H~0~为真(5%)                       | H~1~为真(95%)                    |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(0.25%) | 正确(76%)                        |
| 不能拒绝H~0~ | 正确(4.75%)                        | **第二类错误**/**取伪错误**(19%) |

## 

</br></br> $$\alpha=0.01,\beta=0.2$$

|              | H~0~为真(5%)                     | H~1~为真(95%)                    |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(？%) | 正确(？%)                        |
| 不能拒绝H~0~ | 正确(？%)                        | **第二类错误**/**取伪错误**(？%) |

## 

</br></br>

$$\alpha=0.01,\beta=0.2$$

|              | H~0~为真(5%)                       | H~1~为真(95%)                    |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(0.05%) | 正确(76%)                        |
| 不能拒绝H~0~ | 正确(4.95%)                        | **第二类错误**/**取伪错误**(19%) |

## 

</br></br> $$\alpha=0.05,\beta=0.01$$

|              | H~0~为真(5%)                     | H~1~为真(95%)                    |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(？%) | 正确(？%)                        |
| 不能拒绝H~0~ | 正确(？%)                        | **第二类错误**/**取伪错误**(？%) |

## 

</br></br>

$$\alpha=0.05,\beta=0.01$$

|              | H~0~为真(5%)                       | H~1~为真(95%)                      |
|-------------------|---------------------------|---------------------------|
| 拒绝H~0~     | **第一类错误**/**弃真错误**(0.25%) | 正确(94.05%)                       |
| 不能拒绝H~0~ | 正确(4.75%)                        | **第二类错误**/**取伪错误**(0.95%) |

## 

![](images/image-1768482941.png){fig-align="center"}

<center>Nuzzo,2001,Nature</center>

# 功效分析(power analysis)

## 

![](images/image-743468415.png){fig-align="center"}

https://www.researchgate.net/figure/Statistical-hypothesis-testing-test-d-allowing-to-guarantee-a-prefixed-false-alarm-rate-l_fig3_331206334

## 

</br></br>

敏感性(Sensitivity)是指在真正呈阳性的条件下，出现阳性测试的概率，即H~1~为真的情况下，拒绝H~0~ 的概率

特异性(Specificity)是指在真正阴性的条件下，出现阴性测试的概率，即H~0~为真的情况下，拒绝H~0~ 的概率

## 

</br></br>

|              | H~0~为真            | H~1~为真            |
|--------------|---------------------|---------------------|
| 拒绝H~0~     | 第一类错误/弃真错误 | **统计功效(power)** |
| 不能拒绝H~0~ | 正确                | 第二类错误/取伪错误 |

## 统计功效的意义

</br></br>

$1-\beta$： 统计功效/敏感性

-   如果研究没有足够的统计功效，那么研究可能无法检测到真正的效果。这意味该研究很可能会浪费时间和金钱等资源，甚至从被试那里收集数据也可能是不道德的（尤其是在临床试验中）。

-   如果研究的统计功效很大，意味着该研究对真正的效果高度敏感，包括非常小的效果。这可能会导致发现在统计学上有意义的结果，但在现实世界中的用处很小。

## 影响统计功效的因素

</br></br>

-   效应量(effect size)</br>

-   样本量(sample size)</br>

-   显著性水平

## 效应量(effect size)

</br></br>

-   独立于样本容量，表明变量间实际关联强度的测度值，它可以定量帮助研究者判断统计学意义上的显著性结果是否有实际效用或实际效用的强度

![](images/image-540556860.png){fig-align="center"}

## 

-   效应量大小表明变量之间的差异或群体之间的差异有多大意义，可以反映一项研究结果的实际意义。

-   大的效应大小意味着一项研究结果具有实际意义，而小的效应大小则表明实际应用有限。

## 

</br></br>

Cohen's d它采用两个平均值之间的差异并以标准差单位表示，这就可以使不同量纲之间的效应相互比较。</br>

$$d = \frac{\bar{x_1}-\bar{x_2}}{s}$$ $\bar{x_1}$:组1的平均值</br>

$\bar{x_1}$:组2的平均值</br>

$s$:标准差

## 样本量对统计功效的影响

![](images/image-565139348.png)

## 

![](images/image-888060266.png)

## 效应量对统计功效的影响

![](images/image-1873629172.png)

## 

![](images/image-1082122293.png)

## 样本量与效应量之间的关系

![](images/image-929831473.png)

## 

![](images/image-2116041489.png)

## 效应量和统计功效

![](images/image-709844165.png)

https://rpsychologist.com/cohend/

## 

![](images/image-550404073.png)

## 样本量一定，效应量变化

![](images/image-354949951.png)

https://rpsychologist.com/d3/nhst/

## 效应量一定，样本量变化

![](images/image-919656965.png)

https://rpsychologist.com/d3/nhst/

## 小练习

请大家在该网址动手实践(https://rpsychologist.com/d3/nhst/)，通过调整不同的参数，查看效应量，样本量，显著性水平三者之间的关系。

# 应用

## 先验功效分析
<br><br>

先验功效分析（a priori power analysis）是一种根据期望效应量、显著性水平和统计功效来确定研究所需样本量的统计学方法。它在研究开始之前进行，用于估计足够的样本量以获得足够的统计学功效。换句话说，它帮助研究人员确定他们需要多少参与者在他们的研究中以一定的信心水平检测到一定大小的效应。

## 灵敏度功效分析
<br><br>

灵敏度功效分析(Sensitivity power analysis)是一种探索不同情况如何影响功率分析结果和结论的方法。它有助于研究人员通过检查数据的不同假设如何影响结果来评估其功率分析的稳健性。换句话说，对于给定的α、功率和样本量，你的研究将有多大的功效来检测效应大小。这有助于解释结果，因为你可以概述你的研究对什么效应大小敏感，以及哪些效应太小，你无法可靠地检测。

## 

对于两组被试均为40人的单因素实验

![](images/image1.png)

假设双侧检测标准允许最大一类错误率为$\alpha =0.05$，则每组样本量为40的设计将可靠地(大于0.9的概率)检测出≥0.734的效应量。


![](images/image2.png)

![](images/image3.png)


功效曲线显示，随着效应量的减少(x轴上的值越小)，对于固定的样本量，我们的统计功率越小(y轴上的值越小)。我们期望的90%的功率水平由黑色水平线和黑色曲线的交点表示。

（James E Bartlett & Sarah J Charles，2022）


## 确定样本量

可以使用R的pwr包确定样本量

```{r}
# 设定初始参数
alpha <- 0.05 # 显著性水平
power <- 0.8 # 功效（1-β）, β为第二类错误率
effect_size <- 1 # 效应大小

# 进行功效分析并计算样本量
library(pwr)
pwr.t.test(d = effect_size, sig.level = alpha, power = power)
```

## 如何提高统计功效

-   提高样本量

-   提高效应量

-   提高显著性水平

-   减小测量误差

-   使用单尾检验而不是双尾检验

## 事后的统计功效分析是没有太大意义的

</br></br>

从平均数为100，标准差为15的总体中抽取样本量为36的样本，重复100000次，计算其全部样本的power

![](images/image-1155301581.png)

## 


从平均数为100，标准差为15的总体中抽取样本量为36的样本，重复100000次，选取p值小于0.05的样本，计算其power

![](images/image-1699500077.png)

## 小结

| 概念                                           | 定义                                                                       | 用途                                                                                                                                               |
|------------------------|------------------------|------------------------|
| Alpha (α)<br>显著性水平                        | 我们愿意接受的最大的假阳性概率                                             | 在传统上被设置为0. 05，但在物理等学科中往往被设置为较低的阈值                                                                                      |
| Beta (β) <br>犯二类错误的概率                  | 我们愿意接受的最大的假阴性概率                                             | 在心理学中，这通常被设置为0. 20                                                                                                                    |
| Power (1-β)；<br>统计检验力                    | 检测到真实存在的效应的概率                                                 | 通常设置为0. 80。统计检验力越大，就越有可能成功地发现一个真实存在的效应。                                                                          |
| Effect size；<br>效应量                        | 独立于样本容量，表明变量间实际关联强度的测度值                             | 如Cohen' s d。更高的绝对效应值意味着更大的差异或更强的关系。                                                                                       |
| One-tailed test；<br>单尾检验                  | 当原假设显著性检验中的拒绝域被限制在一个正方向或负方向的尾部时。           | 如果你有一个理想的预先明确的方向预测，单尾检验意味如果结果是你预测的方向，你会拒绝原假设。但当观察到的结果处于相反尾部的极端，仍然无法拒绝原假设。 |
| Two-tailed test；<br>双尾检验                  | 当原假设显著性检验中的拒绝域同时存在于正、负尾区域的极值时。               | 如果你愿意接受任何方向的结果，你可以使用双尾检验来拒绝原假设。观察到的结果处于正尾或负尾的极端，你可以拒绝原假设。                                 |
| a priori power analysis；<br>先验功效分析      | 我们需要多少参与者来可靠地检测alpha和统计功效、给定的兴趣变量的最小效应值? | 我们倾向于在数据收集之前进行的功效分析之前使用"先验"一词。这是因为我们正在从我们已经拥有的信息中推断参与者的数量。                                 |
| Sensitivity power analysis；<br>灵敏度功效分析 | 我们可以用固定的样本量、alpha和期望的功效来检测什么大小的效应量?           | 当我们已经知道有多少个参与者时，我们使用敏感度功效分析。我们使用这种类型的分析来评估我们能够可靠地检测到的效应大小。                               |
